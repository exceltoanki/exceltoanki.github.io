(self.webpackChunkexcel_to_anki=self.webpackChunkexcel_to_anki||[]).push([[3306],{63306:function(t,e,i){"use strict";i.r(e),i.d(e,{HoSoEditorPageModule:function(){return Z}});var s=i(38583),n=i(90665),o=i(92859),r=i(76277),l=i(3633);const h={format:"text",toolbar:[]};var a=i(33018),u=i(8194),d=i(64762),c=i(39075),m=i(75319),g=i(22759),f=i(77393),p=i(33637);function b(t,e=p.P){return i=>i.lift(new v(t,e))}class v{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new E(t,this.dueTime,this.scheduler))}}class E extends f.L{constructor(t,e,i){super(t),this.dueTime=e,this.scheduler=i,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(C,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function C(t){t.debouncedNext()}const q=[[["","quill-editor-toolbar",""]]],y=["[quill-editor-toolbar]"],x={toolbar:[["bold","italic","underline","strike"],["blockquote","code-block"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"],["link","image","video"]]},O=(t,e)=>t||e||"html",T=new a.OlP("config",{providedIn:"root",factory:()=>({modules:x})});let V=(()=>{class t{constructor(t,e){this.config=e,this.count=0,this.document=t.get(s.K0),this.config||(this.config={modules:x})}getQuill(){return this.count++,this.Quill||1!==this.count||(this.$importPromise=new Promise(t=>(0,d.mG)(this,void 0,void 0,function*(){var e,s;const n=this.document.addEventListener;this.document.addEventListener=this.document.__zone_symbol__addEventListener||this.document.addEventListener;const o=yield i.e(2161).then(i.t.bind(i,72161,23));this.document.addEventListener=n,this.Quill=o.default?o.default:o,null===(e=this.config.customOptions)||void 0===e||e.forEach(t=>{const e=this.Quill.import(t.import);e.whitelist=t.whitelist,this.Quill.register(e,!0,this.config.suppressGlobalRegisterWarning)}),null===(s=this.config.customModules)||void 0===s||s.forEach(({implementation:t,path:e})=>{this.Quill.register(e,t,this.config.suppressGlobalRegisterWarning)}),t(this.Quill)}))),this.$importPromise}}return t.\u0275fac=function(e){return new(e||t)(a.LFG(a.zs3),a.LFG(T,8))},t.\u0275prov=a.Yz7({factory:function(){return new t(a.LFG(a.gxx),a.LFG(T,8))},token:t,providedIn:"root"}),t})(),k=(()=>{class t{constructor(t,e,i,n,o,r,l,h){this.elementRef=e,this.cd=i,this.domSanitizer=n,this.platformId=o,this.renderer=r,this.zone=l,this.service=h,this.required=!1,this.customToolbarPosition="top",this.sanitize=!1,this.styles=null,this.strict=!0,this.customOptions=[],this.customModules=[],this.preserveWhitespace=!1,this.trimOnValidation=!1,this.compareValues=!1,this.filterNull=!1,this.defaultEmptyValue=null,this.onEditorCreated=new a.vpe,this.onEditorChanged=new a.vpe,this.onContentChanged=new a.vpe,this.onSelectionChanged=new a.vpe,this.onFocus=new a.vpe,this.onBlur=new a.vpe,this.disabled=!1,this.subscription=null,this.valueGetter=(t,e)=>{let i=e.querySelector(".ql-editor").innerHTML;"<p><br></p>"!==i&&"<div><br></div>"!==i||(i=this.defaultEmptyValue);let s=i;const n=O(this.format,this.service.config.format);if("text"===n)s=t.getText();else if("object"===n)s=t.getContents();else if("json"===n)try{s=JSON.stringify(t.getContents())}catch(o){s=t.getText()}return s},this.valueSetter=(t,e)=>{const i=O(this.format,this.service.config.format);if("html"===i)return this.sanitize&&(e=this.domSanitizer.sanitize(a.q3G.HTML,e)),t.clipboard.convert(e);if("json"===i)try{return JSON.parse(e)}catch(s){return[{insert:e}]}return e},this.selectionChangeHandler=(t,e,i)=>{const s=!t&&!!this.onModelTouched;(this.onBlur.observers.length||this.onFocus.observers.length||this.onSelectionChanged.observers.length||s)&&this.zone.run(()=>{null===t?this.onBlur.emit({editor:this.quillEditor,source:i}):null===e&&this.onFocus.emit({editor:this.quillEditor,source:i}),this.onSelectionChanged.emit({editor:this.quillEditor,oldRange:e,range:t,source:i}),s&&this.onModelTouched(),this.cd.markForCheck()})},this.textChangeHandler=(t,e,i)=>{const s=this.quillEditor.getText(),n=this.quillEditor.getContents();let o=this.editorElem.querySelector(".ql-editor").innerHTML;"<p><br></p>"!==o&&"<div><br></div>"!==o||(o=this.defaultEmptyValue);const r=this.trackChanges||this.service.config.trackChanges,l=("user"===i||r&&"all"===r)&&!!this.onModelChange;(this.onContentChanged.observers.length||l)&&this.zone.run(()=>{l&&this.onModelChange(this.valueGetter(this.quillEditor,this.editorElem)),this.onContentChanged.emit({content:n,delta:t,editor:this.quillEditor,html:o,oldDelta:e,source:i,text:s}),this.cd.markForCheck()})},this.editorChangeHandler=(t,e,i,s)=>{if(this.onEditorChanged.observers.length)if("text-change"===t){const n=this.quillEditor.getText(),o=this.quillEditor.getContents();let r=this.editorElem.querySelector(".ql-editor").innerHTML;"<p><br></p>"!==r&&"<div><br></div>"!==r||(r=this.defaultEmptyValue),this.zone.run(()=>{this.onEditorChanged.emit({content:o,delta:e,editor:this.quillEditor,event:t,html:r,oldDelta:i,source:s,text:n}),this.cd.markForCheck()})}else this.zone.run(()=>{this.onEditorChanged.emit({editor:this.quillEditor,event:t,oldRange:i,range:e,source:s}),this.cd.markForCheck()})},this.document=t.get(s.K0)}static normalizeClassNames(t){return t.trim().split(" ").reduce((t,e)=>{const i=e.trim();return i&&t.push(i),t},[])}ngAfterViewInit(){return(0,d.mG)(this,void 0,void 0,function*(){if((0,s.PM)(this.platformId))return;const t=yield this.service.getQuill();this.elementRef.nativeElement.insertAdjacentHTML("top"===this.customToolbarPosition?"beforeend":"afterbegin",this.preserveWhitespace?"<pre quill-editor-element></pre>":"<div quill-editor-element></div>"),this.editorElem=this.elementRef.nativeElement.querySelector("[quill-editor-element]");const e=this.elementRef.nativeElement.querySelector("[quill-editor-toolbar]"),i=Object.assign({},this.modules||this.service.config.modules);e?i.toolbar=e:void 0===i.toolbar&&(i.toolbar=x.toolbar);let n=void 0!==this.placeholder?this.placeholder:this.service.config.placeholder;void 0===n&&(n="Insert text here ..."),this.styles&&Object.keys(this.styles).forEach(t=>{this.renderer.setStyle(this.editorElem,t,this.styles[t])}),this.classes&&this.addClasses(this.classes),this.customOptions.forEach(e=>{const i=t.import(e.import);i.whitelist=e.whitelist,t.register(i,!0)}),this.customModules.forEach(({implementation:e,path:i})=>{t.register(i,e)});let o=this.bounds&&"self"===this.bounds?this.editorElem:this.bounds;o||(o=this.service.config.bounds?this.service.config.bounds:this.document.body);let r=this.debug;!r&&!1!==r&&this.service.config.debug&&(r=this.service.config.debug);let l=this.readOnly;l||!1===this.readOnly||(l=void 0!==this.service.config.readOnly&&this.service.config.readOnly);let h=this.defaultEmptyValue;this.service.config.hasOwnProperty("defaultEmptyValue")&&(h=this.service.config.defaultEmptyValue);let a=this.scrollingContainer;a||null===this.scrollingContainer||(a=null===this.service.config.scrollingContainer||this.service.config.scrollingContainer?this.service.config.scrollingContainer:null);let u=this.formats;if(u||void 0!==u||(u=this.service.config.formats?[...this.service.config.formats]:null===this.service.config.formats?null:void 0),this.zone.runOutsideAngular(()=>{var e,s,d;if(this.quillEditor=new t(this.editorElem,{bounds:o,debug:r,formats:u,modules:i,placeholder:n,readOnly:l,defaultEmptyValue:h,scrollingContainer:a,strict:this.strict,theme:this.theme||(this.service.config.theme?this.service.config.theme:"snow")}),this.linkPlaceholder){const t=null===(s=null===(e=this.quillEditor)||void 0===e?void 0:e.theme)||void 0===s?void 0:s.tooltip,i=null===(d=null==t?void 0:t.root)||void 0===d?void 0:d.querySelector("input[data-link]");(null==i?void 0:i.dataset)&&(i.dataset.link=this.linkPlaceholder)}}),this.content){if("text"===O(this.format,this.service.config.format))this.quillEditor.setText(this.content,"silent");else{const t=this.valueSetter(this.quillEditor,this.content);this.quillEditor.setContents(t,"silent")}this.quillEditor.getModule("history").clear()}this.setDisabledState(),this.addQuillEventListeners(),(this.onEditorCreated.observers.length||this.onValidatorChanged)&&requestAnimationFrame(()=>{this.onValidatorChanged&&this.onValidatorChanged(),this.onEditorCreated.emit(this.quillEditor)})})}ngOnDestroy(){this.dispose()}ngOnChanges(t){if(this.quillEditor){if(t.readOnly&&this.quillEditor.enable(!t.readOnly.currentValue),t.placeholder&&(this.quillEditor.root.dataset.placeholder=t.placeholder.currentValue),t.defaultEmptyValue&&(this.quillEditor.root.dataset.defaultEmptyValue=t.defaultEmptyValue.currentValue),t.styles){const e=t.styles.currentValue,i=t.styles.previousValue;i&&Object.keys(i).forEach(t=>{this.renderer.removeStyle(this.editorElem,t)}),e&&Object.keys(e).forEach(t=>{this.renderer.setStyle(this.editorElem,t,this.styles[t])})}if(t.classes){const e=t.classes.currentValue,i=t.classes.previousValue;i&&this.removeClasses(i),e&&this.addClasses(e)}t.debounceTime&&this.addQuillEventListeners()}}addClasses(e){t.normalizeClassNames(e).forEach(t=>{this.renderer.addClass(this.editorElem,t)})}removeClasses(e){t.normalizeClassNames(e).forEach(t=>{this.renderer.removeClass(this.editorElem,t)})}writeValue(t){if(this.filterNull&&null===t)return;if(this.content=t,!this.quillEditor)return;const e=O(this.format,this.service.config.format),i=this.valueSetter(this.quillEditor,t);if(this.compareValues){const t=this.quillEditor.getContents();if(JSON.stringify(t)===JSON.stringify(i))return}t?"text"===e?this.quillEditor.setText(t):this.quillEditor.setContents(i):this.quillEditor.setText("")}setDisabledState(t=this.disabled){this.disabled=t,this.quillEditor&&(t?(this.quillEditor.disable(),this.renderer.setAttribute(this.elementRef.nativeElement,"disabled","disabled")):(this.readOnly||this.quillEditor.enable(),this.renderer.removeAttribute(this.elementRef.nativeElement,"disabled")))}registerOnChange(t){this.onModelChange=t}registerOnTouched(t){this.onModelTouched=t}registerOnValidatorChange(t){this.onValidatorChanged=t}validate(){if(!this.quillEditor)return null;const t={};let e=!0;const i=this.quillEditor.getText(),s=this.trimOnValidation?i.trim().length:1===i.length&&0===i.trim().length?0:i.length-1,n=this.quillEditor.getContents().ops,o=n&&1===n.length&&["\n",""].includes(n[0].insert);return this.minLength&&s&&s<this.minLength&&(t.minLengthError={given:s,minLength:this.minLength},e=!1),this.maxLength&&s>this.maxLength&&(t.maxLengthError={given:s,maxLength:this.maxLength},e=!1),this.required&&!s&&o&&(t.requiredError={empty:!0},e=!1),e?null:t}addQuillEventListeners(){this.dispose(),this.zone.runOutsideAngular(()=>{this.subscription=new m.w,this.subscription.add((0,g.R)(this.quillEditor,"selection-change").subscribe(([t,e,i])=>{this.selectionChangeHandler(t,e,i)}));let t=(0,g.R)(this.quillEditor,"text-change"),e=(0,g.R)(this.quillEditor,"editor-change");"number"==typeof this.debounceTime&&(t=t.pipe(b(this.debounceTime)),e=e.pipe(b(this.debounceTime))),this.subscription.add(t.subscribe(([t,e,i])=>{this.textChangeHandler(t,e,i)})),this.subscription.add(e.subscribe(([t,e,i,s])=>{this.editorChangeHandler(t,e,i,s)}))})}dispose(){null!==this.subscription&&(this.subscription.unsubscribe(),this.subscription=null)}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(a.zs3),a.Y36(a.SBq),a.Y36(a.sBO),a.Y36(c.H7),a.Y36(a.Lbi),a.Y36(a.Qsj),a.Y36(a.R0b),a.Y36(V))},t.\u0275dir=a.lG2({type:t,inputs:{required:"required",customToolbarPosition:"customToolbarPosition",sanitize:"sanitize",styles:"styles",strict:"strict",customOptions:"customOptions",customModules:"customModules",preserveWhitespace:"preserveWhitespace",trimOnValidation:"trimOnValidation",compareValues:"compareValues",filterNull:"filterNull",defaultEmptyValue:"defaultEmptyValue",valueGetter:"valueGetter",valueSetter:"valueSetter",format:"format",theme:"theme",modules:"modules",debug:"debug",readOnly:"readOnly",placeholder:"placeholder",maxLength:"maxLength",minLength:"minLength",formats:"formats",scrollingContainer:"scrollingContainer",bounds:"bounds",trackChanges:"trackChanges",classes:"classes",linkPlaceholder:"linkPlaceholder",debounceTime:"debounceTime"},outputs:{onEditorCreated:"onEditorCreated",onEditorChanged:"onEditorChanged",onContentChanged:"onContentChanged",onSelectionChanged:"onSelectionChanged",onFocus:"onFocus",onBlur:"onBlur"},features:[a.TTD]}),t})(),S=(()=>{class t extends k{constructor(t,e,i,s,n,o,r,l){super(t,e,i,s,n,o,r,l)}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(a.zs3),a.Y36(a.SBq),a.Y36(a.sBO),a.Y36(c.H7),a.Y36(a.Lbi),a.Y36(a.Qsj),a.Y36(a.R0b),a.Y36(V))},t.\u0275cmp=a.Xpm({type:t,selectors:[["quill-editor"]],features:[a._Bn([{multi:!0,provide:n.JU,useExisting:(0,a.Gpc)(()=>t)},{multi:!0,provide:n.Cf,useExisting:(0,a.Gpc)(()=>t)}]),a.qOj],ngContentSelectors:y,decls:1,vars:0,template:function(t,e){1&t&&(a.F$t(q),a.Hsn(0))},styles:["\n    :host {\n      display: inline-block;\n    }\n    "],encapsulation:2}),t})(),w=(()=>{class t{static forRoot(e){return{ngModule:t,providers:[{provide:T,useValue:e}]}}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[s.ez]]}),t})();const L=["myquill"];function z(t,e){if(1&t){const t=a.EpF();a.TgZ(0,"ion-button",10),a.NdJ("click",function(){const e=a.CHM(t).$implicit;return a.oxw().changeEditor(e.action)}),a._UZ(1,"ion-icon",11),a._uU(2),a.qZA()}if(2&t){const t=e.$implicit,i=a.oxw();a.Q6J("disabled",t.action==i.currentEditFor),a.xp6(2),a.hij(" ",t.text," ")}}const M=[{path:"",component:(()=>{class t{constructor(t,e){this.router=t,this.hososervice=e,this.buttons=[{text:"Thay th\u1ebf",icon:"repeat-outline",action:"replace"},{text:"Front.html",icon:"logo-html5",action:"front"},{text:"Back.html",icon:"logo-html5",action:"back"},{text:"Style.css",icon:"sparkles-outline",action:"css"}],this.currentQuill=h,this.modules={toolbar:this.currentQuill.toolbar},this.ngOnInit()}ngOnInit(){if(this.router.getCurrentNavigation().extras.state){let t=this.router.getCurrentNavigation().extras.state;this.hoso=t.hoso,this.changeEditor("replace")}else this.router.navigate(["/t/ho-so"])}changeEditor(t){this.currentEditFor=t,this.quillresult=this.hoso[t],(["front","back"].indexOf(t)>-1||["replace","css"].indexOf(t)>-1)&&(this.currentQuill=h)}contentChanged(t){null!=this.quillresult&&(this.hoso[this.currentEditFor]=this.quillresult)}saveChinhSua(){this.hososervice.updateHoSo(this.hoso,l.A.hoso.saveFromEditor)}ionViewWillLeave(){this.saveChinhSua()}}return t.\u0275fac=function(e){return new(e||t)(a.Y36(r.F0),a.Y36(u.y))},t.\u0275cmp=a.Xpm({type:t,selectors:[["app-ho-so-editor"]],viewQuery:function(t,e){if(1&t&&a.Gf(L,5),2&t){let t;a.iGM(t=a.CRH())&&(e.myquill=t.first)}},decls:15,vars:6,consts:[["color","primary"],["slot","start"],[3,"text"],["slot","primary","color","secondary"],["shape","round",1,"taohoso",3,"click"],[1,"hide960"],["slot","end","name","save"],[3,"modules","ngModel","format","ngModelChange","onContentChanged"],["myquill",""],[3,"disabled","click",4,"ngFor","ngForOf"],[3,"disabled","click"],["slot","start","name","repeat-outline"]],template:function(t,e){1&t&&(a.TgZ(0,"ion-header"),a.TgZ(1,"ion-toolbar",0),a.TgZ(2,"ion-buttons",1),a._UZ(3,"ion-back-button",2),a.qZA(),a.TgZ(4,"ion-title"),a._uU(5),a.qZA(),a.TgZ(6,"ion-buttons",3),a.TgZ(7,"ion-button",4),a.NdJ("click",function(){return e.saveChinhSua()}),a.TgZ(8,"span",5),a._uU(9,"L\u01b0u"),a.qZA(),a._UZ(10,"ion-icon",6),a.qZA(),a.qZA(),a.qZA(),a.qZA(),a.TgZ(11,"ion-content"),a.TgZ(12,"quill-editor",7,8),a.NdJ("ngModelChange",function(t){return e.quillresult=t})("onContentChanged",function(t){return e.contentChanged(t)}),a.qZA(),a.YNc(14,z,3,2,"ion-button",9),a.qZA()),2&t&&(a.xp6(3),a.Q6J("text","Tr\u1edf v\u1ec1"),a.xp6(2),a.Oqu(null==e.hoso?null:e.hoso.name),a.xp6(7),a.Q6J("modules",e.modules)("ngModel",e.quillresult)("format",e.currentQuill.format),a.xp6(2),a.Q6J("ngForOf",e.buttons))},directives:[o.Gu,o.sr,o.Sm,o.oU,o.cs,o.wd,o.YG,o.gu,o.W2,S,n.JJ,n.On,s.sg],styles:[""]}),t})()}];let F=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[r.Bz.forChild(M)],r.Bz]}),t})(),Z=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=a.oAB({type:t}),t.\u0275inj=a.cJS({imports:[[s.ez,n.u5,o.Pc,F,w.forRoot()]]}),t})()}}]);